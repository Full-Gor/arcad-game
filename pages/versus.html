<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Starship Battle 1v1</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            display: flex;
            height: 100vh;
            font-family: Arial, sans-serif;
        }

        #gameCanvas {
            flex-grow: 1;
            background: linear-gradient(to bottom, #000033, #000011);
        }

        .divider {
            position: absolute;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #ff0000, #ff6600);
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        #scoreBoard {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            color: white;
            z-index: 20;
        }

        .team-score {
            display: flex;
            align-items: center;
        }

        .team-score img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }

        .lives-container {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }

        .life-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            background: url('/img/lives.jpg') no-repeat center/contain;
        }
    </style>
</head>
<body>
    <div id="scoreBoard">
        <div class="team-score team1">
            <img src="/img/starship1.jpg" alt="Team 1">
            <span id="team1Score">0</span>
            <div id="team1Lives" class="lives-container"></div>
        </div>
        <div class="team-score team2">
            <img src="/img/starship2.jpg" alt="Team 2">
            <span id="team2Score">0</span>
            <div id="team2Lives" class="lives-container"></div>
        </div>
    </div>
    <div class="divider"></div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Configuration de base
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Charger les images des vaisseaux
        const team1Ship = new Image();
        team1Ship.src = '/img/starship1.jpg';
        const team2Ship = new Image();
        team2Ship.src = '/img/starship2.jpg';

        // Configuration des équipes
        const teamConfig = {
            team1: {
                ship: {
                    x: canvas.width * 0.5, 
                    y: canvas.height * 0.25, 
                    width: 100, 
                    height: 100, 
                    lives: 3,
                    image: team1Ship
                }
            },
            team2: {
                ship: {
                    x: canvas.width * 0.5, 
                    y: canvas.height * 0.75, 
                    width: 100, 
                    height: 100, 
                    lives: 3,
                    image: team2Ship
                }
            }
        };

        // Initialiser les vies
        function initializeLives() {
            const team1LivesContainer = document.getElementById('team1Lives');
            const team2LivesContainer = document.getElementById('team2Lives');
            
            team1LivesContainer.innerHTML = '';
            team2LivesContainer.innerHTML = '';
            
            for (let i = 0; i < teamConfig.team1.ship.lives; i++) {
                const lifeIcon = document.createElement('div');
                lifeIcon.classList.add('life-icon');
                team1LivesContainer.appendChild(lifeIcon);
            }
            
            for (let i = 0; i < teamConfig.team2.ship.lives; i++) {
                const lifeIcon = document.createElement('div');
                lifeIcon.classList.add('life-icon');
                team2LivesContainer.appendChild(lifeIcon);
            }
        }
        initializeLives();

        // État du jeu
        const gameState = {
            team1Bullets: [],
            team2Bullets: [],
            paused: false
        };

        // Gestion des événements clavier
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
        });
        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // Contrôles des vaisseaux de l'équipe 1
        const team1Controls = {
            left: 'KeyA', 
            right: 'KeyD', 
            up: 'KeyW', 
            down: 'KeyS', 
            shoot: 'KeyQ'
        };

        // Contrôles des vaisseaux de l'équipe 2
        const team2Controls = {
            left: 'ArrowLeft', 
            right: 'ArrowRight', 
            up: 'ArrowUp', 
            down: 'ArrowDown', 
            shoot: 'Space'
        };

        function moveShip(ship, team) {
            const controls = team === 'team1' ? team1Controls : team2Controls;
            const speed = 5;

            // Déplacements
            if (keys[controls.left]) ship.x -= speed;
            if (keys[controls.right]) ship.x += speed;
            if (keys[controls.up]) ship.y -= speed;
            if (keys[controls.down]) ship.y += speed;

            // Limites de l'écran et de la zone d'équipe
            const midPoint = canvas.height / 2;
            
            ship.x = Math.max(ship.width/2, Math.min(canvas.width - ship.width/2, ship.x));
            ship.y = Math.max(
                team === 'team1' ? ship.height/2 : midPoint + ship.height/2, 
                Math.min(
                    team === 'team1' ? midPoint - ship.height/2 : canvas.height - ship.height/2, 
                    ship.y
                )
            );

            // Tir
            if (keys[controls.shoot]) {
                shootBullet(ship, team);
            }
        }

        function shootBullet(ship, team) {
            const bulletSpeed = 10;
            const bulletColor = team === 'team1' ? '#04fbac' : '#FF7F50';
            
            const newBullet = {
                x: ship.x,
                y: ship.y,
                color: bulletColor,
                team: team
            };

            // Déterminer la direction du tir
            newBullet.vy = team === 'team1' ? bulletSpeed : -bulletSpeed;

            if (team === 'team1') {
                gameState.team1Bullets.push(newBullet);
            } else {
                gameState.team2Bullets.push(newBullet);
            }
        }

        function updateBullets() {
            // Mise à jour et vérification des balles de l'équipe 1
            gameState.team1Bullets = gameState.team1Bullets.filter(bullet => {
                bullet.y += bullet.vy;
                return bullet.y > 0 && bullet.y < canvas.height;
            });

            // Mise à jour et vérification des balles de l'équipe 2
            gameState.team2Bullets = gameState.team2Bullets.filter(bullet => {
                bullet.y += bullet.vy;
                return bullet.y > 0 && bullet.y < canvas.height;
            });
        }

        function drawShips() {
            // Dessiner le vaisseau de l'équipe 1
            const team1Ship = teamConfig.team1.ship;
            if (team1Ship.image.complete) {
                ctx.drawImage(
                    team1Ship.image, 
                    team1Ship.x - team1Ship.width/2, 
                    team1Ship.y - team1Ship.height/2, 
                    team1Ship.width, 
                    team1Ship.height
                );
            } else {
                ctx.fillStyle = '#04fbac';
                ctx.fillRect(
                    team1Ship.x - team1Ship.width/2, 
                    team1Ship.y - team1Ship.height/2, 
                    team1Ship.width, 
                    team1Ship.height
                );
            }

            // Dessiner le vaisseau de l'équipe 2
            const team2Ship = teamConfig.team2.ship;
            if (team2Ship.image.complete) {
                ctx.drawImage(
                    team2Ship.image, 
                    team2Ship.x - team2Ship.width/2, 
                    team2Ship.y - team2Ship.height/2, 
                    team2Ship.width, 
                    team2Ship.height
                );
            } else {
                ctx.fillStyle = '#FF7F50';
                ctx.fillRect(
                    team2Ship.x - team2Ship.width/2, 
                    team2Ship.y - team2Ship.height/2, 
                    team2Ship.width, 
                    team2Ship.height
                );
            }
        }

        function drawBullets() {
            // Dessiner les balles de l'équipe 1
            gameState.team1Bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
                ctx.fill();
            });

            // Dessiner les balles de l'équipe 2
            gameState.team2Bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function checkCollisions() {
            const team1Ship = teamConfig.team1.ship;
            const team2Ship = teamConfig.team2.ship;

            // Vérifier les collisions des balles de l'équipe 1 avec le vaisseau de l'équipe 2
            gameState.team1Bullets.forEach((bullet, bulletIndex) => {
                if (Math.abs(bullet.x - team2Ship.x) < team2Ship.width/2 && 
                    Math.abs(bullet.y - team2Ship.y) < team2Ship.height/2) {
                    // Collision détectée
                    team2Ship.lives--;
                    gameState.team1Bullets.splice(bulletIndex, 1);
                    
                    // Mettre à jour les vies
                    const team2LivesContainer = document.getElementById('team2Lives');
                    team2LivesContainer.removeChild(team2LivesContainer.lastChild);
                    
                    // Mettre à jour le score
                    if (team2Ship.lives <= 0) {
                        document.getElementById('team1Score').textContent = 
                            parseInt(document.getElementById('team1Score').textContent) + 1;
                        
                        // Réinitialiser les vies et repositionner
                        team2Ship.lives = 3;
                        team2Ship.x = canvas.width * 0.5;
                        team2Ship.y = canvas.height * 0.75;
                        initializeLives();
                    }
                }
            });

            // Vérifier les collisions des balles de l'équipe 2 avec le vaisseau de l'équipe 1
            gameState.team2Bullets.forEach((bullet, bulletIndex) => {
                if (Math.abs(bullet.x - team1Ship.x) < team1Ship.width/2 && 
                    Math.abs(bullet.y - team1Ship.y) < team1Ship.height/2) {
                    // Collision détectée
                    team1Ship.lives--;
                    gameState.team2Bullets.splice(bulletIndex, 1);
                    
                    // Mettre à jour les vies
                    const team1LivesContainer = document.getElementById('team1Lives');
                    team1LivesContainer.removeChild(team1LivesContainer.lastChild);
                    
                    // Mettre à jour le score
                    if (team1Ship.lives <= 0) {
                        document.getElementById('team2Score').textContent = 
                            parseInt(document.getElementById('team2Score').textContent) + 1;
                        
                        // Réinitialiser les vies et repositionner
                        team1Ship.lives = 3;
                        team1Ship.x = canvas.width * 0.5;
                        team1Ship.y = canvas.height * 0.25;
                        initializeLives();
                    }
                }
            });
        }

        function gameLoop() {
            // Effacer le canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Déplacer les vaisseaux
            moveShip(teamConfig.team1.ship, 'team1');
            moveShip(teamConfig.team2.ship, 'team2');

            // Mettre à jour et dessiner les balles
            updateBullets();
            drawBullets();

            // Dessiner les vaisseaux
            drawShips();

            // Vérifier les collisions
            checkCollisions();

            // Demander la prochaine frame
            requestAnimationFrame(gameLoop);
        }

        // Gérer le redimensionnement de la fenêtre
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // Repositionner les vaisseaux
            const midPoint = canvas.height / 2;
            teamConfig.team1.ship.x = canvas.width * 0.5;
            teamConfig.team1.ship.y = midPoint * 0.5;

            teamConfig.team2.ship.x = canvas.width * 0.5;
            teamConfig.team2.ship.y = midPoint * 1.5;
        });

        // S'assurer que les images sont chargées avant de démarrer
        Promise.all([
            new Promise(resolve => team1Ship.onload = resolve),
            new Promise(resolve => team2Ship.onload = resolve)
        ]).then(() => {
            // Démarrer le jeu
            gameLoop();
        });
    </script>
</body>
</html>